{% extends 'staff/base.html' %}
{% load humanize %}

{% block title %}{{ title }} - PMIS 2.0{% endblock %}

{% block page_title %}{{ title }}{% endblock %}
{% block page_subtitle %}
    {% if action == 'view' %}
        ì—…ì²´ ì •ë³´ ìƒì„¸ ì¡°íšŒ
    {% elif action == 'create' %}
        ìƒˆë¡œìš´ ì—…ì²´ ë“±ë¡
    {% else %}
        ì—…ì²´ ì •ë³´ ìˆ˜ì •
    {% endif %}
{% endblock %}

{% block content %}
{% if not not_logged_in %}
{{ block.super }}
{% endif %}

{% if not not_logged_in %}
<style>
    .form-container {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        padding: 30px;
        max-width: 1000px;
        margin: 0 auto;
    }

    .form-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
    }

    input[type="text"],
    input[type="email"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 14px;
        font-family: inherit;
    }

    input[type="checkbox"] {
        margin-right: 10px;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .readonly-field {
        background-color: #f8f9fa !important;
        cursor: not-allowed;
    }

    .readonly-display {
        padding: 8px 12px;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        color: #333;
        font-size: 14px;
        font-weight: 600;
        min-height: 20px;
    }

    .current-file {
        margin-top: 5px;
        font-size: 12px;
        color: #666;
    }

    .current-file a {
        color: #007bff;
        text-decoration: none;
    }

    .current-file a:hover {
        text-decoration: underline;
    }

    input[type="file"] {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: white;
        font-size: 14px;
        width: 100%;
    }

    input[type="file"]:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
    }

    .delete-checkbox {
        display: block;
        margin-top: 5px;
        font-size: 12px;
        color: #dc3545;
        cursor: pointer;
    }

    .delete-checkbox input[type="checkbox"] {
        margin-right: 5px;
        width: auto;
    }

    .delete-checkbox:hover {
        background-color: #fff5f5;
        padding: 2px 4px;
        border-radius: 3px;
    }

    .file-help {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }

    .current-files {
        margin-top: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
    }

    .current-files strong {
        display: block;
        margin-bottom: 10px;
        color: #333;
    }

    .file-item {
        margin-bottom: 5px;
        padding: 5px 0;
    }

    .file-item:last-child {
        margin-bottom: 0;
    }

    input[type="file"][multiple] {
        border: 2px dashed #ddd;
        padding: 20px;
        text-align: center;
        background-color: #fafafa;
    }

    input[type="file"][multiple]:hover {
        border-color: #007bff;
        background-color: #f0f8ff;
    }

    .selected-files {
        margin-top: 10px;
        font-size: 14px;
    }

    .selected-file-item {
        background: #e9ecef;
        padding: 5px 10px;
        margin: 2px 0;
        border-radius: 3px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .file-type-pdf {
        color: #dc3545;
        font-weight: bold;
    }

    .file-type-image {
        color: #28a745;
        font-weight: bold;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin-right: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .button-group {
        margin-top: 30px;
        text-align: center;
    }

    .form-row {
        display: flex;
        gap: 20px;
    }

    .form-row .form-group {
        flex: 1;
    }

    .form-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
    }

    .form-section-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
        border-bottom: 2px solid #007bff;
        padding-bottom: 5px;
    }

    .checkbox-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
    }

    small {
        color: #666;
        font-size: 12px;
    }
</style>

<div class="form-container">
    {% if read_only %}
    <div class="alert alert-info">
        <strong>ğŸ“– ì½ê¸° ì „ìš© ëª¨ë“œ</strong><br>
        ì´ ì •ë³´ëŠ” ì¡°íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.
    </div>
    <form>
    {% else %}
    <form method="post" enctype="multipart/form-data" onsubmit="return prepareFormSubmission()">
        {% csrf_token %}
    {% endif %}

        <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
        <div class="form-section">
            <div class="form-section-title">ê¸°ë³¸ ì •ë³´</div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sName1">ì—´ë¦°ì—…ì²´ëª…1</label>
                    <input type="text"
                           id="sName1"
                           name="sName1"
                           value="{{ company.sName1|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}
                           oninput="generateNames()">
                    <small>ì˜ˆ: "ì„œìš¸1í˜¸ ì˜ë“±í¬" ì…ë ¥ì‹œ ìë™ìœ¼ë¡œ "ì„œìš¸1í˜¸", "ì„œìš¸1"ê°€ ì…ë ¥ë©ë‹ˆë‹¤.</small>
                </div>
                <div class="form-group">
                    <label for="sName2">ì—´ë¦°ì—…ì²´ëª…2</label>
                    <input type="text"
                           id="sName2"
                           name="sName2"
                           value="{{ company.sName2|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                    <small>ìë™ ìƒì„±: "ì„œìš¸1í˜¸"</small>
                </div>
                <div class="form-group">
                    <label for="sName3">ì—´ë¦°ì—…ì²´ëª…3</label>
                    <input type="text"
                           id="sName3"
                           name="sName3"
                           value="{{ company.sName3|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                    <small>ìë™ ìƒì„±: "ì„œìš¸1"</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sCompanyName">ì—…ì²´ëª…</label>
                    <input type="text"
                           id="sCompanyName"
                           name="sCompanyName"
                           value="{{ company.sCompanyName|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sNaverID">ë„¤ì´ë²„ ID</label>
                    <input type="text"
                           id="sNaverID"
                           name="sNaverID"
                           value="{{ company.sNaverID|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nType">ì—…ì²´ íƒ€ì…</label>
                    <select id="nType" name="nType" {% if read_only %}disabled{% endif %}>
                        <option value="0" {% if company.nType == 0 %}selected{% endif %}>ì¼ë°˜í† íƒˆ</option>
                        <option value="1" {% if company.nType == 1 %}selected{% endif %}>ê³ ì •ë¹„í† íƒˆ</option>
                        <option value="2" {% if company.nType == 2 %}selected{% endif %}>ë¶€ë¶„ë‹¨ì¢…</option>
                        <option value="3" {% if company.nType == 3 %}selected{% endif %}>ìˆœìˆ˜ë‹¨ì¢…</option>
                        <option value="4" {% if company.nType == 4 %}selected{% endif %}>btocì œíœ´</option>
                        <option value="5" {% if company.nType == 5 %}selected{% endif %}>btobì œíœ´</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nCondition">ì—…ì²´ ìƒíƒœ</label>
                    <select id="nCondition" name="nCondition" {% if read_only %}disabled{% endif %}>
                        <option value="0" {% if company.nCondition == 0 %}selected{% endif %}>ì¤€ë¹„ì¤‘</option>
                        <option value="1" {% if company.nCondition == 1 %}selected{% endif %}>ì •ìƒ</option>
                        <option value="2" {% if company.nCondition == 2 %}selected{% endif %}>ì¼ì‹œì •ì§€</option>
                        <option value="3" {% if company.nCondition == 3 %}selected{% endif %}>íƒˆí‡´</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="sAddress">ì£¼ì†Œ</label>
                <textarea id="sAddress"
                          name="sAddress"
                          rows="3"
                          {% if read_only %}readonly class="readonly-field"{% endif %}>{{ company.sAddress|default:'' }}</textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nMember">ì§ì›ìˆ˜</label>
                    <input type="number"
                           id="nMember"
                           name="nMember"
                           value="{{ company.nMember|default:0 }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sBuildLicense">ë³´ìœ  ê±´ì„¤ë©´í—ˆ</label>
                    <input type="text"
                           id="sBuildLicense"
                           name="sBuildLicense"
                           value="{{ company.sBuildLicense|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="fileBuildLicense">ê±´ì„¤ë©´í—ˆ ì‚¬ì§„</label>
                    {% if read_only %}
                        {% if company.fileBuildLicense %}
                            <div class="readonly-display">
                                <a href="{{ company.fileBuildLicense.url }}" target="_blank">ğŸ“ {{ company.fileBuildLicense.name }}</a>
                            </div>
                        {% else %}
                            <div class="readonly-display">-</div>
                        {% endif %}
                    {% else %}
                        <input type="file"
                               id="fileBuildLicense"
                               name="fileBuildLicense"
                               accept=".jpg,.jpeg,.png,.gif,.bmp,.webp">
                        {% if company.fileBuildLicense %}
                            <div class="current-file">
                                í˜„ì¬ ì‚¬ì§„: <a href="{{ company.fileBuildLicense.url }}" target="_blank">{{ company.fileBuildLicense.name }}</a>
                                <label class="delete-checkbox">
                                    <input type="checkbox" name="delete_fileBuildLicense" value="1">
                                    ì‚¬ì§„ ì‚­ì œ
                                </label>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="fileLicense">ì‚¬ì—…ìë“±ë¡ì¦ ì‚¬ì§„</label>
                    {% if read_only %}
                        {% if company.fileLicense %}
                            <div class="readonly-display">
                                <a href="{{ company.fileLicense.url }}" target="_blank">ğŸ“ {{ company.fileLicense.name }}</a>
                            </div>
                        {% else %}
                            <div class="readonly-display">-</div>
                        {% endif %}
                    {% else %}
                        <input type="file"
                               id="fileLicense"
                               name="fileLicense"
                               accept=".jpg,.jpeg,.png,.gif,.bmp,.webp">
                        {% if company.fileLicense %}
                            <div class="current-file">
                                í˜„ì¬ ì‚¬ì§„: <a href="{{ company.fileLicense.url }}" target="_blank">{{ company.fileLicense.name }}</a>
                                <label class="delete-checkbox">
                                    <input type="checkbox" name="delete_fileLicense" value="1">
                                    ì‚¬ì§„ ì‚­ì œ
                                </label>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <div class="form-group">
                <label for="sStrength">ì—…ì²´ íŠ¹ì¥ì </label>
                <textarea id="sStrength"
                          name="sStrength"
                          rows="3"
                          {% if read_only %}readonly class="readonly-field"{% endif %}>{{ company.sStrength|default:'' }}</textarea>
            </div>
        </div>

        <!-- ë‹´ë‹¹ì ì •ë³´ ì„¹ì…˜ -->
        <div class="form-section">
            <div class="form-section-title">ë‹´ë‹¹ì ì •ë³´</div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sCeoName">ëŒ€í‘œìëª… *</label>
                    <input type="text"
                           id="sCeoName"
                           name="sCeoName"
                           value="{{ company.sCeoName|default:'' }}"
                           {% if not read_only %}required{% endif %}
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sCeoPhone">ëŒ€í‘œì ì—°ë½ì²˜ *</label>
                    <input type="text"
                           id="sCeoPhone"
                           name="sCeoPhone"
                           value="{{ company.sCeoPhone|default:'' }}"
                           {% if not read_only %}required{% endif %}
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sCeoMail">ëŒ€í‘œì ì´ë©”ì¼</label>
                    <input type="email"
                           id="sCeoMail"
                           name="sCeoMail"
                           value="{{ company.sCeoMail|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="fileCeo">ëŒ€í‘œì ì‚¬ì§„</label>
                    {% if read_only %}
                        {% if company.fileCeo %}
                            <div class="readonly-display">
                                <a href="{{ company.fileCeo.url }}" target="_blank">ğŸ“ {{ company.fileCeo.name }}</a>
                            </div>
                        {% else %}
                            <div class="readonly-display">-</div>
                        {% endif %}
                    {% else %}
                        <input type="file"
                               id="fileCeo"
                               name="fileCeo"
                               accept=".jpg,.jpeg,.png,.gif,.bmp,.webp">
                        {% if company.fileCeo %}
                            <div class="current-file">
                                í˜„ì¬ ì‚¬ì§„: <a href="{{ company.fileCeo.url }}" target="_blank">{{ company.fileCeo.name }}</a>
                                <label class="delete-checkbox">
                                    <input type="checkbox" name="delete_fileCeo" value="1">
                                    ì‚¬ì§„ ì‚­ì œ
                                </label>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sSaleName">ì˜ì—…ë‹´ë‹¹ìëª…</label>
                    <input type="text"
                           id="sSaleName"
                           name="sSaleName"
                           value="{{ company.sSaleName|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sSalePhone">ì˜ì—…ë‹´ë‹¹ì ì—°ë½ì²˜</label>
                    <input type="text"
                           id="sSalePhone"
                           name="sSalePhone"
                           value="{{ company.sSalePhone|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sSaleMail">ì˜ì—…ë‹´ë‹¹ì ì´ë©”ì¼</label>
                    <input type="email"
                           id="sSaleMail"
                           name="sSaleMail"
                           value="{{ company.sSaleMail|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="fileSale">ì˜ì—…ë‹´ë‹¹ì ì‚¬ì§„</label>
                    {% if read_only %}
                        {% if company.fileSale %}
                            <div class="readonly-display">
                                <a href="{{ company.fileSale.url }}" target="_blank">ğŸ“ {{ company.fileSale.name }}</a>
                            </div>
                        {% else %}
                            <div class="readonly-display">-</div>
                        {% endif %}
                    {% else %}
                        <input type="file"
                               id="fileSale"
                               name="fileSale"
                               accept=".jpg,.jpeg,.png,.gif,.bmp,.webp">
                        {% if company.fileSale %}
                            <div class="current-file">
                                í˜„ì¬ ì‚¬ì§„: <a href="{{ company.fileSale.url }}" target="_blank">{{ company.fileSale.name }}</a>
                                <label class="delete-checkbox">
                                    <input type="checkbox" name="delete_fileSale" value="1">
                                    ì‚¬ì§„ ì‚­ì œ
                                </label>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sAccoutName">íšŒê³„ë‹´ë‹¹ìëª…</label>
                    <input type="text"
                           id="sAccoutName"
                           name="sAccoutName"
                           value="{{ company.sAccoutName|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sAccoutPhone">íšŒê³„ë‹´ë‹¹ì ì—°ë½ì²˜</label>
                    <input type="text"
                           id="sAccoutPhone"
                           name="sAccoutPhone"
                           value="{{ company.sAccoutPhone|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sAccoutMail">íšŒê³„ë‹´ë‹¹ì ì´ë©”ì¼</label>
                    <input type="email"
                           id="sAccoutMail"
                           name="sAccoutMail"
                           value="{{ company.sAccoutMail|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sEmergencyName">ë¹„ìƒì—°ë½ì²˜ëª…</label>
                    <input type="text"
                           id="sEmergencyName"
                           name="sEmergencyName"
                           value="{{ company.sEmergencyName|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sEmergencyPhone">ë¹„ìƒì—°ë½ì²˜</label>
                    <input type="text"
                           id="sEmergencyPhone"
                           name="sEmergencyPhone"
                           value="{{ company.sEmergencyPhone|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sEmergencyRelation">ë¹„ìƒì—°ë½ì²˜ ê´€ê³„</label>
                    <input type="text"
                           id="sEmergencyRelation"
                           name="sEmergencyRelation"
                           value="{{ company.sEmergencyRelation|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>
        </div>

        <!-- ê³„ì•½ ì •ë³´ ì„¹ì…˜ -->
        <div class="form-section">
            <div class="form-section-title">ê³„ì•½ ì •ë³´</div>

            <div class="form-row">
                <div class="form-group">
                    <label for="dateJoin">ê°€ì…ì¼</label>
                    <input type="date"
                           id="dateJoin"
                           name="dateJoin"
                           value="{{ company.dateJoin|date:'Y-m-d' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="nJoinFee">ê°€ì…ë¹„(ì›)</label>
                    {% if read_only %}
                        <div class="readonly-display">{{ company.nJoinFee|default:0|intcomma }}ì›</div>
                        <input type="hidden" name="nJoinFee" value="{{ company.nJoinFee|default:0 }}">
                    {% else %}
                        <input type="text"
                               id="nJoinFee"
                               name="nJoinFee"
                               value="{% if company.nJoinFee and company.nJoinFee != 0 %}{{ company.nJoinFee|intcomma }}{% else %}0{% endif %}"
                               placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 1,000,000)"
                               class="money-input"
                               oninput="formatMoney(this)">
                        <input type="hidden" id="nJoinFee_raw" name="nJoinFee_raw" value="{{ company.nJoinFee|default:0 }}">
                    {% endif %}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nDeposit">ë³´ì¦ê¸ˆ(ì›)</label>
                    {% if read_only %}
                        <div class="readonly-display">{{ company.nDeposit|default:0|intcomma }}ì›</div>
                        <input type="hidden" name="nDeposit" value="{{ company.nDeposit|default:0 }}">
                    {% else %}
                        <input type="text"
                               id="nDeposit"
                               name="nDeposit"
                               value="{% if company.nDeposit and company.nDeposit != 0 %}{{ company.nDeposit|intcomma }}{% else %}0{% endif %}"
                               placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 5,000,000)"
                               class="money-input"
                               oninput="formatMoney(this)">
                        <input type="hidden" id="nDeposit_raw" name="nDeposit_raw" value="{{ company.nDeposit|default:0 }}">
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="nFixFee">ê³ ì •ë¹„(ì›)</label>
                    {% if read_only %}
                        <div class="readonly-display">{{ company.nFixFee|default:0|intcomma }}ì›</div>
                        <input type="hidden" name="nFixFee" value="{{ company.nFixFee|default:0 }}">
                    {% else %}
                        <input type="text"
                               id="nFixFee"
                               name="nFixFee"
                               value="{% if company.nFixFee and company.nFixFee != 0 %}{{ company.nFixFee|intcomma }}{% else %}0{% endif %}"
                               placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 200,000)"
                               class="money-input"
                               oninput="formatMoney(this)">
                        <input type="hidden" id="nFixFee_raw" name="nFixFee_raw" value="{{ company.nFixFee|default:0 }}">
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="dateFixFeeStart">ê³ ì •ë¹„ ì‹œì‘ì¼</label>
                    <input type="date"
                           id="dateFixFeeStart"
                           name="dateFixFeeStart"
                           value="{{ company.dateFixFeeStart|date:'Y-m-d' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="fFeePercent">ìˆ˜ìˆ˜ë£Œìœ¨(%)</label>
                    <input type="number"
                           step="0.01"
                           id="fFeePercent"
                           name="fFeePercent"
                           value="{{ company.fFeePercent|default:0.0 }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="nOrderFee">ì˜¤ë”ë‹¹ ìˆ˜ìˆ˜ë£Œ(ì›)</label>
                    {% if read_only %}
                        <div class="readonly-display">{{ company.nOrderFee|default:0|intcomma }}ì›</div>
                        <input type="hidden" name="nOrderFee" value="{{ company.nOrderFee|default:0 }}">
                    {% else %}
                        <input type="text"
                               id="nOrderFee"
                               name="nOrderFee"
                               value="{% if company.nOrderFee and company.nOrderFee != 0 %}{{ company.nOrderFee|intcomma }}{% else %}0{% endif %}"
                               placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 50,000)"
                               class="money-input"
                               oninput="formatMoney(this)">
                        <input type="hidden" id="nOrderFee_raw" name="nOrderFee_raw" value="{{ company.nOrderFee|default:0 }}">
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="nReportPeriod">ë³´ê³ ì£¼ê¸°</label>
                    <input type="number"
                           id="nReportPeriod"
                           name="nReportPeriod"
                           value="{{ company.nReportPeriod|default:0 }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="contractFiles">ì—´ë¦°ì—…ì²´íšŒì› ê°€ì…í˜‘ì•½ì„œ</label>
                    {% if read_only %}
                        {% if company.contract_files.exists %}
                            <div class="readonly-display">
                                {% for contract_file in company.contract_files.all %}
                                    <div class="file-item">
                                        <a href="{{ contract_file.file.url }}" target="_blank">ğŸ“ {{ contract_file.name }}</a>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="readonly-display">-</div>
                        {% endif %}
                    {% else %}
                        <input type="file"
                               id="contractFiles"
                               name="contractFiles"
                               accept=".jpg,.jpeg,.png,.gif,.bmp,.webp,.pdf"
                               multiple
                               onchange="updateFileList(this)">
                        <div class="file-help">ì—¬ëŸ¬ íŒŒì¼ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì´ë¯¸ì§€: jpg, png, gif ë“± / ë¬¸ì„œ: PDF)</div>
                        <div id="selectedFiles" class="selected-files"></div>

                        {% if company.contract_files.exists %}
                            <div class="current-files">
                                <strong>í˜„ì¬ ì—…ë¡œë“œëœ ì—´ë¦°ì—…ì²´íšŒì› ê°€ì…í˜‘ì•½ì„œ:</strong>
                                {% for contract_file in company.contract_files.all %}
                                    <div class="current-file">
                                        <a href="{{ contract_file.file.url }}" target="_blank">{{ contract_file.name }}</a>
                                        <label class="delete-checkbox">
                                            <input type="checkbox" name="delete_contract_file" value="{{ contract_file.id }}">
                                            íŒŒì¼ ì‚­ì œ
                                        </label>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
                <div class="form-group">
                    <label for="fileCampaignAgree">ê³„ì•½ ë° í•˜ìì´í–‰ë³´ì¦ì¦ê¶Œ ë°œí–‰ ìº í˜ì¸ ì°¸ì—¬ë™ì˜ì„œ</label>
                    {% if read_only %}
                        {% if company.fileCampaignAgree %}
                            <div class="readonly-display">
                                <a href="{{ company.fileCampaignAgree.url }}" target="_blank">ğŸ“ {{ company.fileCampaignAgree.name }}</a>
                            </div>
                        {% else %}
                            <div class="readonly-display">-</div>
                        {% endif %}
                    {% else %}
                        <input type="file"
                               id="fileCampaignAgree"
                               name="fileCampaignAgree"
                               accept=".jpg,.jpeg,.png,.gif,.bmp,.webp">
                        {% if company.fileCampaignAgree %}
                            <div class="current-file">
                                í˜„ì¬ ì‚¬ì§„: <a href="{{ company.fileCampaignAgree.url }}" target="_blank">{{ company.fileCampaignAgree.name }}</a>
                                <label class="delete-checkbox">
                                    <input type="checkbox" name="delete_fileCampaignAgree" value="1">
                                    ì‚¬ì§„ ì‚­ì œ
                                </label>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ê³µì‚¬ ê°€ëŠ¥í•œ ë¶„ì•¼ ì„¹ì…˜ -->
        <div class="form-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div class="form-section-title" style="margin-bottom: 0;">ê³µì‚¬ ê°€ëŠ¥í•œ ë¶„ì•¼</div>
                <button type="button"
                        id="possibleAreaButton"
                        class="btn btn-secondary"
                        style="padding: 8px 16px; font-size: 12px;"
                        onclick="goToPossibleArea()">
                    ê³µì‚¬ ê°€ëŠ¥í•œ ì§€ì—­
                </button>
            </div>

            <!-- ì²« ë²ˆì§¸ ì¤„: ì•„íŒŒíŠ¸ ì˜¬ìˆ˜ë¦¬, ì£¼íƒ ì˜¬ìˆ˜ë¦¬, ìƒê°€ ì˜¬ìˆ˜ë¦¬ -->
            <div style="display: flex; align-items: flex-start; margin-bottom: 15px;">
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bAptAll"
                           name="bAptAll"
                           {% if company.bAptAll %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bAptAll">ì•„íŒŒíŠ¸ ì˜¬ìˆ˜ë¦¬</label>
                </div>
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bHouseAll"
                           name="bHouseAll"
                           {% if company.bHouseAll %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bHouseAll">ì£¼íƒ ì˜¬ìˆ˜ë¦¬</label>
                </div>
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bCommerceAll"
                           name="bCommerceAll"
                           {% if company.bCommerceAll %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bCommerceAll">ìƒê°€ ì˜¬ìˆ˜ë¦¬</label>
                </div>
            </div>

            <!-- ë‘ ë²ˆì§¸ ì¤„: ì•„íŒŒíŠ¸ ë¶€ë¶„ìˆ˜ë¦¬, ì£¼íƒ ë¶€ë¶„ìˆ˜ë¦¬, ìƒê°€ ë¶€ë¶„ìˆ˜ë¦¬ -->
            <div style="display: flex; align-items: flex-start; margin-bottom: 15px;">
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bAptPart"
                           name="bAptPart"
                           {% if company.bAptPart %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bAptPart">ì•„íŒŒíŠ¸ ë¶€ë¶„ìˆ˜ë¦¬</label>
                </div>
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bHousePart"
                           name="bHousePart"
                           {% if company.bHousePart %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bHousePart">ì£¼íƒ ë¶€ë¶„ìˆ˜ë¦¬</label>
                </div>
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bCommercePart"
                           name="bCommercePart"
                           {% if company.bCommercePart %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bCommercePart">ìƒê°€ ë¶€ë¶„ìˆ˜ë¦¬</label>
                </div>
            </div>

            <!-- ì„¸ ë²ˆì§¸ ì¤„: ì‹ ì¶•/ì¦ì¶•, ë¶€ê°€ì„œë¹„ìŠ¤ -->
            <div style="display: flex; align-items: flex-start; margin-bottom: 15px;">
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bBuild"
                           name="bBuild"
                           {% if company.bBuild %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bBuild">ì‹ ì¶•/ì¦ì¶•</label>
                </div>
                <div class="checkbox-group" style="min-width: 150px;">
                    <input type="checkbox"
                           id="bExtra"
                           name="bExtra"
                           {% if company.bExtra %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bExtra">ë¶€ê°€ì„œë¹„ìŠ¤</label>
                </div>
            </div>
        </div>

        <!-- ê¸°íƒ€ ì •ë³´ ì„¹ì…˜ -->
        <div class="form-section">
            <div class="form-section-title">ê¸°íƒ€ ì •ë³´</div>

            <!-- ì½ê¸° ì „ìš© ì •ë³´ -->
            <div class="checkbox-grid">
                <div class="checkbox-group">
                    <input type="checkbox"
                           id="bPrivacy"
                           {% if company.bPrivacy %}checked{% endif %}
                           disabled>
                    <label for="bPrivacy">ê°œì¸ì •ë³´ë™ì˜</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox"
                           id="bCompetition"
                           {% if company.bCompetition %}checked{% endif %}
                           disabled>
                    <label for="bCompetition">ê²½ì—…ê¸ˆì§€ë™ì˜</label>
                </div>
            </div>

            <!-- ì…ë ¥ ê°€ëŠ¥í•œ ì²´í¬ë°•ìŠ¤ -->
            <div class="checkbox-grid">
                <div class="checkbox-group">
                    <input type="checkbox"
                           id="bUnion"
                           name="bUnion"
                           {% if company.bUnion %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bUnion">ì—°í•©íšŒ</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox"
                           id="bMentor"
                           name="bMentor"
                           {% if company.bMentor %}checked{% endif %}
                           {% if read_only %}disabled{% endif %}>
                    <label for="bMentor">ë©˜í† </label>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sMentee">ë©˜í‹°</label>
                    <input type="text"
                           id="sMentee"
                           name="sMentee"
                           value="{{ company.sMentee|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="nRefund">ì„ í˜¸ í™˜ë¶ˆë°©ì‹</label>
                    <select id="nRefund" name="nRefund" {% if read_only %}disabled{% endif %}>
                        <option value="0" {% if company.nRefund == 0 %}selected{% endif %}>ê³„ì¢Œì´ì²´</option>
                        <option value="1" {% if company.nRefund == 1 %}selected{% endif %}>í¬ì¸íŠ¸ì ë¦½</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sManager">ë‹´ë‹¹ ìŠ¤í…</label>
                    {% if read_only %}
                    <input type="text"
                           value="{{ company.sManager|default:'' }}"
                           readonly class="readonly-field">
                    {% else %}
                    <select id="sManager" name="sManager">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        {% for staff in staff_list %}
                            <option value="{{ staff.sNick }}"
                                    {% if company.sManager == staff.sNick %}selected{% endif %}>
                                {{ staff.sNick }}({{ staff.sName }})
                            </option>
                        {% endfor %}
                    </select>
                    {% endif %}
                </div>
            </div>

            <div class="form-group">
                <label for="sMemo">ë©”ëª¨</label>
                <textarea id="sMemo"
                          name="sMemo"
                          rows="4"
                          {% if read_only %}readonly class="readonly-field"{% endif %}>{{ company.sMemo|default:'' }}</textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="dateWithdraw">íƒˆí‡´ì¼</label>
                    <input type="date"
                           id="dateWithdraw"
                           name="dateWithdraw"
                           value="{{ company.dateWithdraw|date:'Y-m-d' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sWithdraw">íƒˆí‡´ì‚¬ìœ </label>
                    <input type="text"
                           id="sWithdraw"
                           name="sWithdraw"
                           value="{{ company.sWithdraw|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="sPicture">ì—…ì²´ì‚¬ì§„</label>
                    <input type="text"
                           id="sPicture"
                           name="sPicture"
                           value="{{ company.sPicture|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sGallery">ê°¤ëŸ¬ë¦¬ë°©</label>
                    <input type="text"
                           id="sGallery"
                           name="sGallery"
                           value="{{ company.sGallery|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
                <div class="form-group">
                    <label for="sEstimate">ê²¬ì ë°©</label>
                    <input type="text"
                           id="sEstimate"
                           name="sEstimate"
                           value="{{ company.sEstimate|default:'' }}"
                           {% if read_only %}readonly class="readonly-field"{% endif %}>
                </div>
            </div>
        </div>

        <div class="button-group">
            {% if not read_only %}
                <button type="submit" class="btn btn-primary">
                    {% if action == 'create' %}ì¶”ê°€{% else %}ìˆ˜ì •{% endif %}
                </button>
            {% endif %}
            <a href="{% url 'company:company_list' %}" class="btn btn-secondary">
                {% if read_only %}â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°{% else %}ì·¨ì†Œ{% endif %}
            </a>
        </div>

    </form>
</div>

{% if not read_only %}
<script>
    function generateNames() {
        const sName1 = document.getElementById('sName1').value.trim();

        if (sName1) {
            // sName1ì—ì„œ sName2, sName3 ìë™ ìƒì„±
            // ì˜ˆ: "ì„œìš¸1í˜¸ ì˜ë“±í¬" -> sName2: "ì„œìš¸1í˜¸", sName3: "ì„œìš¸1"

            const parts = sName1.split(' ');

            if (parts.length >= 2) {
                // ì²« ë²ˆì§¸ ë¶€ë¶„ì„ sName2ë¡œ (ì˜ˆ: "ì„œìš¸1í˜¸")
                document.getElementById('sName2').value = parts[0];

                // ì²« ë²ˆì§¸ ë¶€ë¶„ì—ì„œ ìˆ«ìì™€ "í˜¸"ë¥¼ ì œê±°í•˜ì—¬ sName3 ìƒì„±
                // ì˜ˆ: "ì„œìš¸1í˜¸" -> "ì„œìš¸1"
                let sName3 = parts[0].replace(/í˜¸$/, ''); // ëì˜ "í˜¸" ì œê±°
                document.getElementById('sName3').value = sName3;
            } else {
                // ê³µë°±ì´ ì—†ëŠ” ê²½ìš°, sName1ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •
                document.getElementById('sName2').value = sName1;

                // "í˜¸"ë§Œ ì œê±°í•˜ì—¬ sName3 ìƒì„±
                let sName3 = sName1.replace(/í˜¸$/, '');
                document.getElementById('sName3').value = sName3;
            }
        } else {
            // sName1ì´ ë¹„ì–´ìˆìœ¼ë©´ ë‚˜ë¨¸ì§€ë„ ë¹„ìš°ê¸°
            document.getElementById('sName2').value = '';
            document.getElementById('sName3').value = '';
        }
    }

    // ê¸ˆì•¡ í¬ë§·íŒ… í•¨ìˆ˜ (ì‹¤ì‹œê°„ ì½¤ë§ˆ ì¶”ê°€)
    function formatMoney(input) {
        // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±° (ì½¤ë§ˆ í¬í•¨)
        let value = input.value.replace(/[^0-9]/g, '');

        // ë¹ˆ ê°’ì´ë©´ 0ìœ¼ë¡œ ì„¤ì •
        if (value === '') {
            value = '0';
        }

        // ìˆ«ìë¥¼ ì •ìˆ˜ë¡œ ë³€í™˜
        let numValue = parseInt(value);

        // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€
        let formattedValue = numValue.toLocaleString('ko-KR');

        // ì…ë ¥ í•„ë“œì— í¬ë§·ëœ ê°’ ì„¤ì •
        input.value = formattedValue;

        // ìˆ¨ê²¨ì§„ í•„ë“œì— ì›ë˜ ìˆ«ì ê°’ ì €ì¥
        let hiddenField = document.getElementById(input.id + '_raw');
        if (hiddenField) {
            hiddenField.value = numValue;
        }
    }

    // í¼ ì œì¶œ ì‹œ ìˆ¨ê²¨ì§„ í•„ë“œ ê°’ì„ ì›ë³¸ í•„ë“œë¡œ ë³µì‚¬
    function prepareFormSubmission() {
        const moneyInputs = ['nJoinFee', 'nDeposit', 'nFixFee', 'nOrderFee'];

        moneyInputs.forEach(function(fieldName) {
            const visibleField = document.getElementById(fieldName);
            const hiddenField = document.getElementById(fieldName + '_raw');

            if (visibleField && hiddenField) {
                // ìˆ¨ê²¨ì§„ í•„ë“œì˜ ê°’ì„ ì›ë³¸ í•„ë“œì— ë³µì‚¬ (í¼ ì œì¶œìš©)
                visibleField.name = fieldName; // name ì†ì„± ìœ ì§€
                visibleField.value = hiddenField.value; // ìˆ«ì ê°’ë§Œ ì „ì†¡
                hiddenField.name = ''; // ìˆ¨ê²¨ì§„ í•„ë“œëŠ” ì „ì†¡í•˜ì§€ ì•ŠìŒ
            }
        });

        // ëˆ„ì ëœ íŒŒì¼ë“¤ì„ í¼ì— ì „ë‹¬
        if (accumulatedFiles.length > 0) {
            const contractFilesInput = document.getElementById('contractFiles');

            // ìƒˆë¡œìš´ íŒŒì¼ ì…ë ¥ í•„ë“œë“¤ì„ ë™ì ìœ¼ë¡œ ìƒì„±
            const form = contractFilesInput.form;

            // ê¸°ì¡´ ë™ì  ìƒì„± íŒŒì¼ í•„ë“œë“¤ ì œê±°
            const existingDynamicInputs = form.querySelectorAll('.dynamic-contract-file');
            existingDynamicInputs.forEach(input => input.remove());

            // ëˆ„ì ëœ íŒŒì¼ë“¤ì„ ìœ„í•œ ìƒˆë¡œìš´ input í•„ë“œë“¤ ìƒì„±
            accumulatedFiles.forEach((file, index) => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.name = 'contractFiles';
                fileInput.className = 'dynamic-contract-file';
                fileInput.style.display = 'none';

                // DataTransferë¥¼ ì‚¬ìš©í•´ì„œ File ê°ì²´ë¥¼ inputì— ì„¤ì •
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;

                form.appendChild(fileInput);
            });

            console.log('Added', accumulatedFiles.length, 'accumulated files to form');
        }

        // ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ ë””ë²„ê¹…
        const contractFilesInput = document.getElementById('contractFiles');
        if (contractFilesInput) {
            console.log('Contract files input found:', contractFilesInput);
            console.log('Selected files count:', contractFilesInput.files.length);
            for (let i = 0; i < contractFilesInput.files.length; i++) {
                console.log('File ' + i + ':', contractFilesInput.files[i].name);
            }
        }

        return true; // í¼ ì œì¶œ ê³„ì† ì§„í–‰
    }

    // ëˆ„ì ëœ íŒŒì¼ë“¤ì„ ì €ì¥í•  ë°°ì—´
    let accumulatedFiles = [];

    // ì„ íƒëœ íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸ (ëˆ„ì  ê¸°ëŠ¥ í¬í•¨)
    function updateFileList(input) {
        const selectedFilesDiv = document.getElementById('selectedFiles');
        const newFiles = Array.from(input.files);

        if (newFiles.length === 0) {
            return; // ì•„ë¬´ê²ƒë„ ì„ íƒí•˜ì§€ ì•Šì•˜ìœ¼ë©´ ê¸°ì¡´ íŒŒì¼ ìœ ì§€
        }

        // ìƒˆë¡œ ì„ íƒí•œ íŒŒì¼ë“¤ì„ ëˆ„ì  ë°°ì—´ì— ì¶”ê°€ (ì¤‘ë³µ íŒŒì¼ëª… ì²´í¬)
        newFiles.forEach(newFile => {
            const isDuplicate = accumulatedFiles.some(existingFile => existingFile.name === newFile.name);
            if (!isDuplicate) {
                accumulatedFiles.push(newFile);
            }
        });

        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        input.value = '';

        displayFileList();
    }

    // íŒŒì¼ ëª©ë¡ í‘œì‹œ
    function displayFileList() {
        const selectedFilesDiv = document.getElementById('selectedFiles');

        if (accumulatedFiles.length === 0) {
            selectedFilesDiv.innerHTML = '';
            return;
        }

        let html = '<strong>ì„ íƒëœ íŒŒì¼ (' + accumulatedFiles.length + 'ê°œ):</strong><br>';
        accumulatedFiles.forEach((file, index) => {
            const fileType = file.type.toLowerCase().includes('pdf') ? 'pdf' : 'image';
            const fileTypeClass = 'file-type-' + fileType;
            const fileIcon = fileType === 'pdf' ? 'ğŸ“„' : 'ğŸ–¼ï¸';

            html += '<div class="selected-file-item">';
            html += '<span>' + fileIcon + ' ' + file.name + '</span>';
            html += '<span class="' + fileTypeClass + '">' + fileType.toUpperCase() + '</span>';
            html += '<button type="button" onclick="removeFile(' + index + ')" style="margin-left: 10px; padding: 2px 6px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">ì‚­ì œ</button>';
            html += '</div>';
        });

        selectedFilesDiv.innerHTML = html;
    }

    // ê°œë³„ íŒŒì¼ ì‚­ì œ
    function removeFile(index) {
        accumulatedFiles.splice(index, 1);
        displayFileList();
    }

    // nTypeì— ë”°ë¥¸ bExtra í™œì„±í™”/ë¹„í™œì„±í™”
    function updateExtraCheckbox() {
        const nTypeSelect = document.getElementById('nType');
        const bExtraCheckbox = document.getElementById('bExtra');
        const possibleAreaButton = document.getElementById('possibleAreaButton');

        if (nTypeSelect && bExtraCheckbox) {
            const nTypeValue = parseInt(nTypeSelect.value);

            if ([0, 1, 2, 3].includes(nTypeValue)) {
                // nTypeì´ 0(ì¼ë°˜í† íƒˆ), 1(ê³ ì •ë¹„í† íƒˆ), 2(ë¶€ë¶„ë‹¨ì¢…), 3(ìˆœìˆ˜ë‹¨ì¢…)ì¸ ê²½ìš°
                bExtraCheckbox.disabled = true;
                bExtraCheckbox.checked = false; // ì²´í¬ í•´ì œ

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ "ê³µì‚¬ ê°€ëŠ¥í•œ ì§€ì—­"ìœ¼ë¡œ ì„¤ì •
                if (possibleAreaButton) {
                    possibleAreaButton.textContent = 'ê³µì‚¬ ê°€ëŠ¥í•œ ì§€ì—­';
                }
            } else if (nTypeValue === 4) {
                // nTypeì´ 4(btocì œíœ´)ì¸ ê²½ìš°
                bExtraCheckbox.disabled = true;
                bExtraCheckbox.checked = true; // ì²´í¬ ìƒíƒœë¡œ ì„¤ì •

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ "ì„œë¹„ìŠ¤ ê°€ëŠ¥í•œ ì§€ì—­"ìœ¼ë¡œ ë³€ê²½
                if (possibleAreaButton) {
                    possibleAreaButton.textContent = 'ì„œë¹„ìŠ¤ ê°€ëŠ¥í•œ ì§€ì—­';
                }
            } else {
                // nTypeì´ 5(btobì œíœ´) ë“± ê¸°íƒ€ì¸ ê²½ìš°
                bExtraCheckbox.disabled = false;
                // ê¸°ì¡´ ì²´í¬ ìƒíƒœ ìœ ì§€

                // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ "ê³µì‚¬ ê°€ëŠ¥í•œ ì§€ì—­"ìœ¼ë¡œ ì„¤ì •
                if (possibleAreaButton) {
                    possibleAreaButton.textContent = 'ê³µì‚¬ ê°€ëŠ¥í•œ ì§€ì—­';
                }
            }
        }
    }

    // PossibleArea í™”ë©´ìœ¼ë¡œ ì´ë™ (ì—…ì²´ëª…ìœ¼ë¡œ ê²€ìƒ‰)
    function goToPossibleArea() {
        const sName2 = document.getElementById('sName2').value.trim();
        let url = '{% url "possiblearea:possi_manage" %}';

        if (sName2) {
            // sName2 ê°’ì´ ìˆìœ¼ë©´ URL íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
            url += '?search=' + encodeURIComponent(sName2);
        }

        window.location.href = url;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œì—ë„ ì‹¤í–‰ (ìˆ˜ì • ëª¨ë“œì—ì„œ)
    document.addEventListener('DOMContentLoaded', function() {
        // ìˆ˜ì • ëª¨ë“œì—ì„œ ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ ìë™ ìƒì„±í•˜ì§€ ì•ŠìŒ
        const sName2 = document.getElementById('sName2').value.trim();
        const sName3 = document.getElementById('sName3').value.trim();

        // sName2ë‚˜ sName3ê°€ ë¹„ì–´ìˆì„ ë•Œë§Œ ìë™ ìƒì„±
        if (!sName2 || !sName3) {
            generateNames();
        }

        // ê¸ˆì•¡ í•„ë“œë“¤ ì´ˆê¸° í¬ë§·íŒ…
        const moneyInputs = document.querySelectorAll('.money-input');
        moneyInputs.forEach(function(input) {
            formatMoney(input);
        });

        // nType ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        const nTypeSelect = document.getElementById('nType');
        if (nTypeSelect) {
            nTypeSelect.addEventListener('change', updateExtraCheckbox);
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì„¤ì •
            updateExtraCheckbox();
        }
    });
</script>
{% endif %}

{% endif %}

{% endblock %}